# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

「betrayer2」は、戦略シミュレーションゲームのUnityプロジェクト。三国志風の政治・戦闘・外交システムを持つゲームです。

## コア技術スタック

- **Unity 2023.x**: ゲームエンジン
- **C#**: メインプログラミング言語
- **Rosalina**: UI管理ライブラリ（`com.eastylabs.rosalina`）
- **Unity Localization**: 多言語対応（日本語・英語）
- **Unity Input System**: 入力管理
- **Universal Render Pipeline (URP)**: レンダリングパイプライン

## アーキテクチャ構造

### メインゲームコア
- `GameCore` (Assets/Main/System/GameCore.cs): ゲーム全体の制御中枢
  - シングルトンパターンで実装
  - メインループ（`DoMainLoop()`）で日単位のゲーム進行を管理
  - 世界データ（`WorldData`）、UI、AI、アクションシステムを統合管理

### データ管理
- `WorldData`: ゲーム世界の状態を保持
- `GameDate`: ゲーム内時間管理（月・年単位の処理含む）
- 収入システム、忠誠度、友好度の自動更新機能

### アクションシステム
- `ActionsBase<T>`: アクション基底クラス
- `PersonalActions`: 個人レベルのアクション（開発、訓練等）
- `StrategyActions`: 戦略レベルのアクション（同盟、投資等）
- コスト・実行可能条件・実行処理の統一インターフェース

### UI管理
- Rosalinaライブラリによる自動生成システム
- `MainUI`: メインゲーム画面
- `TitleSceneUI`: タイトル画面
- UXMLファイルとC#コードの連携

### バトルシステム
- `Battle`/`BattleManager`: 戦闘処理
- `CharacterInBattle`: 戦闘中のキャラクター状態
- 兵士の自動回復、連戦ペナルティシステム

## 開発時の注意点

### Rosalinaワークフロー
- UXMLファイル編集後、自動生成コード（`.g.cs`）が更新される
- `Assets/Rosalina/AutoGenerated/`内のファイルは直接編集不可

### ローカライゼーション
- 文字列は`LocalizationManager`経由でアクセス
- 日本語・英語対応済み
- `Assets/_Misc/Localization/`で管理

### AI・ゲームバランス
- AIは`AI.cs`で実装
- キャラクターの性格（平和主義・攻撃的等）が行動パターンに影響
- 収入・支出・忠誠度の複雑な経済システム

### パフォーマンス
- 非同期処理（`async/await`）を多用
- メインループは`Awaitable.WaitForSecondsAsync()`で調整
- 大量の軍勢・キャラクター処理を効率化

## デバッグ・テスト
- `Testing.cs`: ゲーム進行の一時停止・速度調整
- エディタ拡張: `TileInfoEditorWindow.cs`でマップ情報編集

このゲームは複雑な政治・経済・戦闘システムを持つため、変更時は連鎖的な影響を慎重に検討してください。